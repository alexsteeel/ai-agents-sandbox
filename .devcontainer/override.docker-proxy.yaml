# Override to use docker-registry-proxy instead of tinyproxy for Docker service
services:
  docker:
    environment:
      # Use docker-registry-proxy directly by container name
      HTTP_PROXY: http://ai-sbx-docker-proxy:3128
      HTTPS_PROXY: http://ai-sbx-docker-proxy:3128
      NO_PROXY: localhost,127.0.0.1,::1,docker
      http_proxy: http://ai-sbx-docker-proxy:3128
      https_proxy: http://ai-sbx-docker-proxy:3128
      no_proxy: localhost,127.0.0.1,::1,docker
    volumes:
      # Mount proxy CA certificates
      - ai-sbx-proxy-certs:/proxy-ca:ro
    # Connect to proxy network
    networks:
      - claude-internal
      - ai-sbx-proxy-internal

# Add external network and volume references
networks:
  ai-sbx-proxy-internal:
    external: true
    name: ai-sbx-proxy-internal

volumes:
  ai-sbx-proxy-certs:
    external: true
    name: ai-sbx-proxy-certs